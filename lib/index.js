!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){"use strict";function t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function e(e){for(var n=1;arguments.length>n;n++){var r=null!=arguments[n]?arguments[n]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(t){return Object.getOwnPropertyDescriptor(r,t).enumerable}))),o.forEach(function(n){t(e,n,r[n])})}return e}function n(t,e){return(n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function r(t,e,o){return(r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,r){var o=[null];o.push.apply(o,e);var i=new(Function.bind.apply(t,o));return r&&n(i,r.prototype),i}).apply(null,arguments)}function o(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==u.return||u.return()}finally{if(o)throw i}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function i(t){return function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);t.length>e;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var a=require("ethers"),u=require("cbor"),c=require("./OntologyStorage.json"),l=require("./PropositionLedger.json"),s=require("./RlayToken.json"),f=require("./builtins.json"),p=new a.Interface(c.abi),d=new a.Interface(l.abi),y=new a.Interface(s.abi),m=function(t){var e=p.functions["store".concat(t.type)],n=[];return e.inputs.names.forEach(function(r,o){var i="0x";e.inputs.types[o].endsWith("[]")&&(i=[]),n.push(t[r]||t[r.replace("_","")]||i)}),e.apply(void 0,n).data},h=function(t,e){return(0,p.functions["retrieve".concat(t)])(e).data},g=function(t,e){var n=p.functions["retrieve".concat(t)],o=n.parseResult(e),a={type:t};return n.outputs.names.forEach(function(t){var e=o[t];Array.isArray(e)&&(e=r(Array,i(e))),a[t.replace("_","")]=e}),a};module.exports={store:function(t,n,r){var o=p.functions["store".concat(n.type)];return t.rlay.version().then(function(t){return t.contractAddresses.OntologyStorage}).then(function(o){var i=m(n);return t.eth.sendTransaction(e({to:o,data:i},r))}).then(function(t){return o.parseResult(t.logs[0].data)[0]})},retrieve:function(t,n,r){var i=t.rlay.version().then(function(t){return t.contractAddresses.OntologyStorage}),a=t.rlay.experimentalKindForCid(n).then(function(t){return t.kind});return Promise.all([i,a]).then(function(i){var a=o(i,2),u=a[0],c=a[1],l=h(c,n);return t.eth.call(e({to:u,data:l},r)).then(function(t){return g(c,t)})})},addWeight:function(t,n,r,o){var i=d,a=y;return t.rlay.version().then(function(t){return t.contractAddresses}).then(function(u){var c=(0,a.functions.approve)(u.PropositionLedger,r).data,l=(0,i.functions.submitProposition)(n,r).data;return t.eth.sendTransaction(e({to:u.RlayToken,data:c},o)).then(function(){return t.eth.sendTransaction(e({to:u.PropositionLedger,data:l},o))})})},encodeValue:function(t){return u.encode(t)},decodeValue:function(t){return u.decodeFirstSync(t.substring(2,t.length))},encodeForStore:m,extendWeb3WithRlay:function(t){t.extend({property:"rlay",methods:[{name:"version",call:"rlay_version"},{name:"getPropositionPools",call:"rlay_getPropositionPools",outputFormatter:function(e){return e.map(function(e){return e.totalWeight=t.toBigNumber(e.totalWeight),e.values=e.values.map(function(e){return e.totalWeight=t.toBigNumber(e.totalWeight),e}),e})}},{name:"experimentalKindForCid",call:"rlay_experimentalKindForCid",params:1},{name:"experimentalListCids",call:"rlay_experimentalListCids",params:1}]})},extendWeb3OldWithRlay:function(t){t._extend({property:"rlay",methods:[new t._extend.Method({name:"version",call:"rlay_version"}),new t._extend.Method({name:"getPropositionPools",call:"rlay_getPropositionPools",outputFormatter:function(e){return e.map(function(e){return e.totalWeight=t.toBigNumber(e.totalWeight),e.values=e.values.map(function(e){return e.totalWeight=t.toBigNumber(e.totalWeight),e}),e})}}),new t._extend.Method({name:"experimentalKindForCid",call:"rlay_experimentalKindForCid",params:1}),new t._extend.Method({name:"experimentalListCids",call:"rlay_experimentalListCids",params:1})]})},builtins:f}});
