!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t():"function"==typeof define&&define.amd?define(t):t()}(0,function(){"use strict";function e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function t(t){for(var n=1;arguments.length>n;n++){var r=null!=arguments[n]?arguments[n]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(n){e(t,n,r[n])})}return t}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function r(e,t,o){return(r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,r){var o=[null];o.push.apply(o,t);var a=new(Function.bind.apply(e,o));return r&&n(a,r.prototype),a}).apply(null,arguments)}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var i,u=e[Symbol.iterator]();!(r=(i=u.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,a=e}finally{try{r||null==u.return||u.return()}finally{if(o)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(e){return function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);e.length>t;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var i=require("ethers"),u=require("cbor"),l=require("./OntologyStorage.json"),c=require("./PropositionLedger.json"),s=require("./RlayToken.json"),f=require("./builtins.json"),p=new i.Interface(l.abi),d=new i.Interface(c.abi),y=new i.Interface(s.abi),m=function(e){var t=p.functions["store".concat(e.type)],n=[];return t.inputs.names.forEach(function(r,o){var a="0x";t.inputs.types[o].endsWith("[]")&&(a=[]),n.push(e[r]||e[r.replace("_","")]||a)}),t.apply(void 0,n).data},h=function(e,t){return(0,p.functions["retrieve".concat(e)])(t).data},g=function(e,t){var n=p.functions["retrieve".concat(e)],o=n.parseResult(t),i={type:e};return n.outputs.names.forEach(function(e){var t=o[e];Array.isArray(t)&&(t=r(Array,a(t))),i[e.replace("_","")]=t}),i};module.exports={store:function(e,n,r){var o=p.functions["store".concat(n.type)];return e.rlay.version().then(function(e){return e.contractAddresses.OntologyStorage}).then(function(o){var a=m(n);return e.eth.sendTransaction(t({to:o,data:a},r))}).then(function(e){return o.parseResult(e.logs[0].data)[0]})},retrieve:function(e,n,r){return e.rlay.experimentalGetEntity(n).then(function(a){if(a)return Promise.resolve(a);var i=e.rlay.version().then(function(e){return e.contractAddresses.OntologyStorage}),u=e.rlay.experimentalKindForCid(n).then(function(e){return e.kind});return Promise.all([i,u]).then(function(a){var i=o(a,2),u=i[0],l=i[1],c=h(l,n);return e.eth.call(t({to:u,data:c},r)).then(function(e){return g(l,e)})})})},addWeight:function(e,n,r,o){var a=d,i=y;return e.rlay.version().then(function(e){return e.contractAddresses}).then(function(u){var l=(0,i.functions.approve)(u.PropositionLedger,r).data,c=(0,a.functions.submitProposition)(n,r).data;return e.eth.sendTransaction(t({to:u.RlayToken,data:l},o)).then(function(){return e.eth.sendTransaction(t({to:u.PropositionLedger,data:c},o))})})},encodeValue:function(e){return u.encode(e)},decodeValue:function(e){return u.decodeFirstSync(e.substring(2,e.length))},encodeForStore:m,extendWeb3WithRlay:function(e){e.extend({property:"rlay",methods:[{name:"version",call:"rlay_version"},{name:"getPropositionPools",call:"rlay_getPropositionPools",outputFormatter:function(t){return t.map(function(t){return t.totalWeight=e.toBigNumber(t.totalWeight),t.values=t.values.map(function(t){return t.totalWeight=e.toBigNumber(t.totalWeight),t}),t})}},{name:"experimentalKindForCid",call:"rlay_experimentalKindForCid",params:1},{name:"experimentalListCids",call:"rlay_experimentalListCids",params:1},{name:"experimentalListCidsIndex",call:"rlay_experimentalListCidsIndex",params:3},{name:"experimentalGetEntity",call:"rlay_experimentalGetEntity",params:1}]})},extendWeb3OldWithRlay:function(e){e._extend({property:"rlay",methods:[new e._extend.Method({name:"version",call:"rlay_version"}),new e._extend.Method({name:"getPropositionPools",call:"rlay_getPropositionPools",outputFormatter:function(t){return t.map(function(t){return t.totalWeight=e.toBigNumber(t.totalWeight),t.values=t.values.map(function(t){return t.totalWeight=e.toBigNumber(t.totalWeight),t}),t})}}),new e._extend.Method({name:"experimentalKindForCid",call:"rlay_experimentalKindForCid",params:1}),new e._extend.Method({name:"experimentalListCids",call:"rlay_experimentalListCids",params:1}),new e._extend.Method({name:"experimentalListCidsIndex",call:"rlay_experimentalListCidsIndex",params:3}),new e._extend.Method({name:"experimentalGetEntity",call:"rlay_experimentalGetEntity",params:1})]})},builtins:f}});
